function showNativeAlert(a,b){navigator.notification.alert(a,b,"Minew Beacon","OK")}function trim(a){return a.toString().replace(/(^\s*)|(\s*$)/g,"")}function parseDeviceName(a,b){var d,c="";for(d=0;19>d&&"00"!=a.substring(b+2*d,b+2*d+2);d++)c+=String.fromCharCode(toDecimal(a.substring(b+2*d,b+2*d+2)));return""==c?null:c}function parseServiceData(a,b){var c={};return a?0==b?(c["battery"]=toDecimal(a.substring(0,2))>100?100:toDecimal(a.substring(0,2)),c["major"]=toDecimal(a.substring(2,6)),c["minor"]=toDecimal(a.substring(6,10))):(c["battery"]=toDecimal(a.substring(4,6))>100?100:toDecimal(a.substring(4,6)),c["major"]=toDecimal(a.substring(6,10)),c["minor"]=toDecimal(a.substring(10,14))):(c["battery"]=100,c["major"]=0,c["minor"]=0),c}function toDecimal(a){var b,c,d,e,f;if(!a||0==a.length)return 0;if(b=a.toString(),c=/[0-9a-fA-F]+/,d={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15},c.test(b)){for(e=0,f=b.length-1;f>=0;f--)e+=d[b[f].toLowerCase()]*Math.pow(16,b.length-f-1);return e}return 0}function toSignedDecimal(a){var b,c,d,f,g,h,i;if(!a||0==a.length)return 0;if(a=a.toString().toLowerCase(),b=/[0-9a-fA-F]+/,b.test(a)){for(c={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15},d=null,f=[],g=0;g<a.length;g++){h=c[a.charAt(g)],i=[];do d=Math.floor(h%2),i.push(d),h=Math.floor(h/2);while(h>=2);for(i.push(h),j=0;j<4-i.length;)i.push(0);f=f.concat(i.reverse())}if(h=0,1==f[0]){for(g=f.length-1;g>=0;g--)h+=f[g]?0:1*Math.pow(2,f.length-g-1);return-(h+1)}for(g=f.length-1;g>=0;g--)h+=f[g]*Math.pow(2,f.length-g-1);return h}return 0}function toHex(a,b){var c,d;if(b||0==b||(b=1),a=a.toString(),0!=a.length){for(c=parseInt(a,10),d="",parseInt(a,10)>=0?d=c.toString(16).toUpperCase():(c=255+c+1,d=c.toString(16).toUpperCase());d.length<2*b;)d="0"+d;return d}}function connectDevice(a,b){BC.Bluetooth.StopScan(),a.connect(function(){a.discoverServices(function(){var c=a.getServiceByUUID(serviceUUID)[0];c?c.discoverCharacteristics(function(){b(c)},function(){showNativeAlert("Discover characteristic failed,Please try again.",function(){a.disconnect(function(){},function(){}),BC.Bluetooth.StartScan("LE")})}):showNativeAlert("Service "+serviceUUID+" not found.",function(){a.disconnect(function(){},function(){}),BC.Bluetooth.StartScan("LE")})},function(){showNativeAlert("Discover service failed,Please try again.",function(){a.disconnect(function(){},function(){}),BC.Bluetooth.StartScan("LE")})})},function(){showNativeAlert("Connect to device failed",function(){BC.Bluetooth.StartScan("LE")})})}function formatUUID(a){return!a||a.length<32?(console.log("UUID length is not enough"),void 0):a.substring(0,8)+"-"+a.substring(8,12)+"-"+a.substring(12,16)+"-"+a.substring(16,20)+"-"+a.substring(20,32)}function uuidToString(a){for(var b=a.toString();-1!=b.indexOf("-")||-1!=b.indexOf(":");)b=b.replace("-",""),b=b.replace(":","");return b}function calculateAccuracy(a,b){var c,d;return 0==b?-1:(c=1*b/a,1>c?changeTwoDecimal_f(Math.pow(c,10)):(d=.89976*Math.pow(c,7.7095)+.111,changeTwoDecimal_f(d)))}function changeTwoDecimal_f(a){var c,d,b=parseFloat(a);if(isNaN(b))return alert("function:changeTwoDecimal->parameter error"),!1;for(b=Math.round(100*b)/100,c=b.toString(),d=c.indexOf("."),0>d&&(d=c.length,c+=".");c.length<=d+2;)c+="0";return c}angular.module("ionicApp",["ionic"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("eventmenu",{url:"/event","abstract":!0,templateUrl:"templates/event-menu.html"}).state("eventmenu.home",{url:"/home",cache:!1,views:{menuContent:{templateUrl:"templates/home.html"}}}).state("eventmenu.config",{url:"/config",cache:!1,views:{menuContent:{templateUrl:"templates/config.html",controller:"ConfigCtrl"}}}).state("eventmenu.deviceinfo",{url:"/deviceinfo",views:{menuContent:{templateUrl:"templates/deviceinfo.html",controller:"DeviceInfoCtrl"}}}).state("eventmenu.uuid",{url:"/uuid",cache:!1,views:{menuContent:{templateUrl:"templates/uuid.html",controller:"UUIDCtrl"}}}).state("eventmenu.uuid_manualinput",{url:"/uuid_manualinput",cache:!1,views:{menuContent:{templateUrl:"templates/uuid_manualinput.html",controller:"UUID_ManualInputCtrl"}}}).state("eventmenu.major",{url:"/major",cache:!1,views:{menuContent:{templateUrl:"templates/major.html",controller:"MajorCtrl"}}}).state("eventmenu.minor",{url:"/minor",cache:!1,views:{menuContent:{templateUrl:"templates/minor.html",controller:"MinorCtrl"}}}).state("eventmenu.measuredpower",{url:"/measuredpower",cache:!1,views:{menuContent:{templateUrl:"templates/measuredpower.html",controller:"MeasuredPowerCtrl"}}}).state("eventmenu.transimssionpower",{url:"/transimssionpower",cache:!1,views:{menuContent:{templateUrl:"templates/transimssionpower.html",controller:"TransimssionPowerCtrl"}}}).state("eventmenu.changepassword",{url:"/changepassword",cache:!1,views:{menuContent:{templateUrl:"templates/changepassword.html",controller:"ChangePasswordCtrl"}}}).state("eventmenu.broadcastinginterval_manualinput",{url:"/broadcastinginterval_manualinput",cache:!1,views:{menuContent:{templateUrl:"templates/broadcastinginterval_manualinput.html",controller:"BroadcastingIntervalCtrl"}}}).state("eventmenu.broadcastinginterval",{url:"/broadcastinginterval",cache:!1,views:{menuContent:{templateUrl:"templates/broadcastinginterval.html",controller:"BroadcastingIntervalCtrl"}}}).state("eventmenu.connectionmode",{url:"/connectionmode",cache:!1,views:{menuContent:{templateUrl:"templates/connectionmode.html",controller:"ConnectionModeCtrl"}}}).state("eventmenu.serialid",{url:"/serialid",cache:!1,views:{menuContent:{templateUrl:"templates/serialid.html",controller:"SerialIDCtrl"}}}).state("eventmenu.ibeaconname",{url:"/ibeaconname",cache:!1,views:{menuContent:{templateUrl:"templates/ibeaconname.html",controller:"iBeaconNameCtrl"}}}).state("eventmenu.softreboot",{url:"/softreboot",cache:!1,views:{menuContent:{templateUrl:"templates/softreboot.html",controller:"SoftRebootCtrl"}}}).state("eventmenu.about",{url:"/about",views:{menuContent:{templateUrl:"templates/about.html"}}}),b.otherwise("/event/home")}]).controller("MainCtrl",["$scope","$location","$ionicNavBarDelegate","$ionicSideMenuDelegate","$timeout","$interval",function(a,b,c,d,e,f){function l(){document.addEventListener("bcready",r,!1)}function m(){}function n(){}function o(){"/event/home"==b.path()&&q()}function p(){a.items.sort(function(a,b){return a.RSSI<b.RSSI?1:-1})}function q(){var b,c;b&&f.cancel(b),c&&e.cancel(c),k&&f.cancel(k),BC.bluetooth.devices={},a.items=[],g=[],h=0,a.scanning=!0,BC.Bluetooth.StartScan("LE"),u(),b=f(function(){p()},500),c=e(function(){f.cancel(b),e.cancel(c)},5e3)}function r(){document.addEventListener("bluetoothstatechange",m,!1),BC.bluetooth.addEventListener("newdevice",w),BC.bluetooth.addEventListener("newadvpacket",t),q(),a.$on("$locationChangeSuccess",function(){if("/event/home"==b.path()){if(c.showBackButton(!1),a.device){if(a.device.isConnected){if(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]){var d=JSON.parse(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]);delete d.newPassword,delete d.saveChange,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(d)}a.device.disconnect(function(){q()},function(){})}else q();a.device=null,a.services=null}}else c.showBackButton(!0)})}function s(b){var e,f,c=!1,d=a.items.length;for(e=0;d>e;e++)if(f=a.items[e],f.deviceAddress==b.deviceAddress){c=!0;break}return c}function t(a){var b=a.target,c=0;for(c=0;c<g.length;c++)if(g[c].deviceAddress==b.deviceAddress){g[c]=b;break}c>=g.length&&g.push(b)}function u(){k=f(function(){var c,d,e,f,h,b=g.length;for(c=0;b>c;c++)for(d=g[c],e=a.items.length,f=0;e>f;f++)d.deviceAddress==a.items[f].deviceAddress&&(h=BC.bluetooth.devices[a.items[f].deviceAddress],h&&("android"==cordova.platformId?(a.items[f].Distance=calculateAccuracy(-55,h.RSSI),a.items[f].CONN=(3&toDecimal(h.advertisementData.advData.substring(4,6)))>0?"YES":"NO"):(a.items[f].Distance=calculateAccuracy(-46,h.RSSI),a.items[f].CONN=0==h.advertisementData.isConnectable?"NO":"YES"),a.items[f].RSSI=h.RSSI),a.items[f].Distance?a.items[f].Distance<.5?a.items[f].Proximity="Immidiate":a.items[f].Distance<=2?a.items[f].Proximity="Near":a.items[f].Distance>2&&(a.items[f].Proximity="Far"):a.items[f].Proximity="Unknow")},200)}function v(){if(a.device&&localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]){var b=JSON.parse(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]);b.saveChange||b.newPassword&&(delete b.newPassword,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(b))}showNativeAlert("Device is disconnected!",function(){location.href="#/event/home"})}function w(b){var c,d,e,f;a.scanning=!1,c=b.target,s(c)||(d={},d.id=h++,d.RSSI=c.RSSI,e="Unknow Name","android"==cordova.platformId?(localStorage["devicename_"+uuidToString(c.deviceAddress)]&&(e=localStorage["devicename_"+uuidToString(c.deviceAddress)]),f=parseServiceData(c.advertisementData.serviceData,4),d.deviceName=c.deviceName||e,d.Major=f.major,d.Minor=f.minor,d.BATT=f.battery,d.Distance=calculateAccuracy(-55,c.RSSI),d.txPowerLevel=toSignedDecimal(c.advertisementData.txPowerLevel),d.CONN=(3&toDecimal(c.advertisementData.advData.substring(4,6)))>0?"YES":"NO"):(f=parseServiceData(c.advertisementData.serviceData,0),d.Major=f.major,d.Minor=f.minor,d.BATT=f.battery,d.deviceName=c.advertisementData.localName||c.deviceName||e,d.txPowerLevel=c.advertisementData.txPowerLevel||0,d.Distance=calculateAccuracy(-46,c.RSSI),d.CONN=0==c.advertisementData.isConnectable?"NO":"YES"),d.deviceAddress=c.deviceAddress,d.Distance?d.Distance<.5?d.Proximity="Immidiate":d.Distance<=2?d.Proximity="Near":d.Distance>2&&(d.Proximity="Far"):d.Proximity="Unknow",a.items.push(d),c.addEventListener("devicedisconnected",v),a.$apply())}function x(){location.href="#/event/config"}var g,h,k;a.items=[],a.scanning=!1,g=[],h=0,k=null,document.addEventListener("deviceready",l,!1),document.addEventListener("backbutton",n,!1),document.addEventListener("resume",o,!1),a.toggleLeft=function(){d.toggleLeft()},a.refresh=function(){BC.Bluetooth.StopScan(),q()},a.goConfig=function(b){a.device=BC.bluetooth.devices[b.deviceAddress],connectDevice(a.device,x)},a.$on("to-parent",function(b,c){a[c.paramName]=c.paramValue})}]).controller("ConfigCtrl",["$scope","$timeout",function(a){function f(b,g,h){var j,i=c.getCharacteristicByUUID(b);i.length>0?(j=i[0],j.property.contains("read")?j.read(function(b){var c=b.value.getHexString();0==d?(a.services[d].text=formatUUID(c).toUpperCase(),a.services[d].value=formatUUID(c).toUpperCase()):-1!=e.indexOf(d)?(a.services[d].text=toDecimal(c),a.services[d].value=toDecimal(c)):3==d?(a.services[d].text=toSignedDecimal(c)+" dBm",a.services[d].value=toSignedDecimal(c)):8==d?(a.services[d].text=b.value.getASCIIString(),a.services[d].value=b.value.getASCIIString()):(a.services[d].text=c,a.services[d].value=c),a.$apply(),d++<g?f(a.services[d].uuid,g,h):h()},function(){showNativeAlert("Read Characteristic value failed.",function(){location.href="#/event/home"})}):++d<g?f(a.services[d].uuid,g,h):h()):g>d?(a.services.splice(d,1),a.$apply(),f(a.services[d].uuid,g-1,h)):h()}var c,d,e;a.services||(a.services=[],a.services.push({uuid:"FFF1",name:"UUID",text:"",value:""}),a.services.push({uuid:"FFF2",name:"Major",text:"",value:""}),a.services.push({uuid:"FFF3",name:"Minor",text:"",value:""}),a.services.push({uuid:"FFF4",name:"Measured Power",text:"",value:""}),a.services.push({uuid:"FFF5",name:"Transimssion Power",text:"",value:""}),a.services.push({uuid:"FFF6",name:"Change Password",text:"",value:""}),a.services.push({uuid:"FFF7",name:"Broadcasting Interval",text:"",value:""}),a.services.push({uuid:"FFF8",name:"Serial ID",text:"",value:""}),a.services.push({uuid:"FFF9",name:"iBeacon Name",text:"",value:""}),a.services.push({uuid:"FFFB",name:"Temperature",text:"",value:""}),a.services.push({uuid:"FFFC",name:"Accelerometer",text:"",value:""}),a.services.push({uuid:"FFFE",name:"Connection Mode",text:"",value:""}),a.services.push({uuid:"FFFF",name:"Soft Reboot",text:"",value:""}),a.batteryService={value:0},a.device&&(c=a.device.getServiceByUUID(serviceUUID)[0],c?navigator.bluetooth.write(function(){var b=a.device.getServiceByUUID("180f")[0];b&&b.discoverCharacteristics(function(){var c=b.getCharacteristicByUUID("2a19")[0];c&&c.read(function(b){a.batteryService.value=toDecimal(b.value.getHexString());var c=a.services.length;f(a.services[0].uuid,c,function(){})})})},function(){showNativeAlert("Some errors occurred.",function(){location.href="#/event/home"})},a.device.deviceAddress,c.index,writeValue):showNativeAlert("Service "+serviceUUID+" not found.",function(){location.href="#/event/home"}))),d=0,e=[1,2,4,6,7,9,10,11,12],a.$emit("to-parent",{paramName:"services",paramValue:a.services}),a.$emit("to-parent",{paramName:"batteryService",paramValue:a.batteryService}),a.doSomething=function(b,c){b.index=c,location.href="#event/"+b.name.replace(" ","").toLowerCase(),a.$emit("to-parent",{paramName:b.name.replace(" ","").toLowerCase()+"_item",paramValue:b})},a.getDeviceInfo=function(){location.href="#/event/deviceinfo"}}]).controller("DeviceInfoCtrl",["$scope","$location","$timeout",function(a){function d(){a.device.getDeviceInfo(function(){var b,c;a.clientSideList[0].value=a.device.manufacturerName.getHexString(),a.clientSideList[1].value=a.device.modelNum.getASCIIString(),a.clientSideList[2].value=a.device.serialNum.getASCIIString(),a.clientSideList[3].value=a.device.firmwareRevision.getASCIIString(),a.clientSideList[4].value=a.device.hardwareRevision.getASCIIString(),a.clientSideList[5].value=a.device.softwareRevision.getASCIIString(),a.clientSideList[6].value=a.device.systemID.getASCIIString(),b=a.device.getServiceByUUID("180a")[0],b&&(c=b.getCharacteristicByUUID("2a2a")[0],c&&c.read(function(b){a.device.regulatoryCertifactionData=b.value,a.regulatoryCertifactionData.value=b.value.getHexString()},function(){showNativeAlert("Some errors occurred.",function(){location.href="#/event/config"})})),a.$apply()},function(){showNativeAlert("Some errors occurred.",function(){location.href="#/event/config"})})}a.clientSideList=[{name:"System ID",value:""},{name:"Model Number",value:""},{name:"Serial Number",value:""},{name:"Firmware Revision",value:""},{name:"Hardware Revision",value:""},{name:"Software Revision",value:""},{name:"Manufacturer Name",value:""}],a.regulatoryCertifactionData={name:"Regulatory Certifaction Data",value:""},a.device.manufacturerName?(a.clientSideList=[{name:"System ID",value:a.device.manufacturerName.getHexString()},{name:"Model Number",value:a.device.modelNum.getASCIIString()},{name:"Serial Number",value:a.device.serialNum.getASCIIString()},{name:"Firmware Revision",value:a.device.firmwareRevision.getASCIIString()},{name:"Hardware Revision",value:a.device.hardwareRevision.getASCIIString()},{name:"Software Revision",value:a.device.softwareRevision.getASCIIString()},{name:"Manufacturer Name",value:a.device.systemID.getASCIIString()}],a.regulatoryCertifactionData.value=a.device.regulatoryCertifactionData.getHexString()):connectDevice(a.device,d)}]).controller("UUIDCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.uuid_item.uuid)[0];c.write("hex",uuidToString(a.data.clientSide),function(){a.uuid_item.value=a.data.clientSide,a.services[0].text=a.uuid_item.value,a.services[0].value=a.uuid_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.clientSideList=[{text:"E2C56DB5-DFFB-48D2-B060-D0F5A71096E0",value:"E2C56DB5-DFFB-48D2-B060-D0F5A71096E0"},{text:"FDA50693-A4E2-4FB1-AFCF-C6EB07647825",value:"FDA50693-A4E2-4FB1-AFCF-C6EB07647825"},{text:"B9407F30-F5F8-466E-AFF9-25556B57FE6D",value:"B9407F30-F5F8-466E-AFF9-25556B57FE6D"},{text:"74278BDA-B644-4520-8F0C-720EAF059935",value:"74278BDA-B644-4520-8F0C-720EAF059935"}],a.data={clientSide:a.uuid_item.value},a.selectUUID=function(){connectDevice(a.device,c)}}]).controller("UUID_ManualInputCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.uuid_item.uuid)[0];c.write("hex",uuidToString(a.data.value),function(){a.uuid_item.value=a.data.value,a.services[0].text=a.uuid_item.value,a.services[0].value=a.uuid_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={value:a.uuid_item.value},a.saveUUID=function(){connectDevice(a.device,c)}}]).controller("MajorCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.major_item.uuid)[0];c.write("hex",toHex(a.major_item.value,2),function(){a.services[1].text=a.major_item.value,a.services[1].value=a.major_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.saveMajor=function(){return a.major_item.value>65535||a.major_item.value<0?(showNativeAlert("Major input range (0-65535),Please check you input.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]).controller("MinorCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.minor_item.uuid)[0];c.write("hex",toHex(a.minor_item.value,2),function(){a.services[2].text=a.minor_item.value,a.services[2].value=a.minor_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.saveMinor=function(){return a.minor_item.value>65535||a.minor_item.value<0?(showNativeAlert("Minor input range (0-65535),Please check you input.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]).controller("MeasuredPowerCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.measuredpower_item.uuid)[0];c.write("hex",toHex(a.data.value),function(){a.measuredpower_item.value=a.data.value,a.measuredpower_item.text=a.measuredpower_item.value+" dBm",a.services[3].text=a.measuredpower_item.text,a.services[3].value=a.measuredpower_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={value:a.measuredpower_item.value},a.saveMP=function(){connectDevice(a.device,c)}}]).controller("TransimssionPowerCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.transimssionpower_item.uuid)[0];c.write("hex",toHex(a.data.clientSide),function(){a.transimssionpower_item.value=a.data.clientSide,a.services[4].text=a.transimssionpower_item.value,a.services[4].value=a.transimssionpower_item.value,a.$apply(),location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.measuredPowerList=[{text:"-30",value:"0",meters:"2"},{text:"-20",value:"1",meters:"7"},{text:"-16",value:"2",meters:"10"},{text:"-12",value:"3",meters:"15"},{text:"-8",value:"4",meters:"22"},{text:"-4",value:"5",meters:"27"},{text:"0",value:"6",meters:"50"},{text:"4",value:"7",meters:"90"}],a.data={clientSide:a.transimssionpower_item.value},a.selectTP=function(){connectDevice(a.device,c)}}]).controller("ChangePasswordCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.changepassword_item.uuid)[0];c.write("ascii",a.data.password,function(){if(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]){var b=JSON.parse(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]);b.saveChange&&delete b.saveChange,b.newPassword=a.data.password,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(b),console.log(JSON.stringify(b))}location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={password:"",confirmPassword:""},a.changePassword=function(){return 0==trim(a.data.password).length||0==trim(a.data.confirmPassword).length?(showNativeAlert("Write to devie failed,Please check you input.",function(){}),void 0):trim(a.data.password)!=trim(a.data.confirmPassword)?(showNativeAlert("Write to devie failed,Please check you input.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]).controller("BroadcastingIntervalCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.broadcastinginterval_item.uuid)[0],d="";d=a.broadcastinginterval_flag?a.data.clientSide:a.data.value,c.write("hex",toHex(d),function(){a.broadcastinginterval_item.value=a.broadcastinginterval_flag?a.data.clientSide:a.data.value,a.broadcastinginterval_item.text=a.broadcastinginterval_item.value,a.services[6].text=a.broadcastinginterval_item.text,a.services[6].value=a.broadcastinginterval_item.value,location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.broadcastinginterval_flag=!1,a.broadcastingIntervalList=[{text:"100 ms",value:"1"},{text:"200 ms",value:"2"},{text:"300 ms",value:"3"},{text:"400 ms",value:"4"},{text:"500 ms",value:"5"},{text:"600 ms",value:"6"},{text:"700 ms",value:"7"},{text:"800 ms",value:"8"},{text:"900 ms",value:"9"},{text:"1000 ms",value:"10"}],a.data={clientSide:a.broadcastinginterval_item.value,value:""},a.selectBI=function(){a.broadcastinginterval_flag=!0,connectDevice(a.device,c)},a.saveBI=function(){return 0==trim(a.data.value).length||a.data.value<11||a.data.value>100?(showNativeAlert("Manual input range (11-100).The unit is 100ms,Please check you input.",function(){}),void 0):(a.broadcastinginterval_flag=!1,connectDevice(a.device,c),void 0)}}]).controller("SerialIDCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.serialid_item.uuid)[0];c.write("hex",toHex(a.data.value,4),function(){a.serialid_item.value=a.data.value,a.services[7].text=a.serialid_item.value,a.services[7].value=a.serialid_item.value,location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={value:a.serialid_item.value},a.saveSerialID=function(){return 0==trim(a.data.value).length||a.data.value<1||a.data.value>99999?(showNativeAlert("Serial ID input (1-99999).The unit is 100ms,Please check you input.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]).controller("iBeaconNameCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.ibeaconname_item.uuid)[0];c.write("ascii",a.data.value,function(){a.ibeaconname_item.value=a.data.value,a.services[8].text=a.ibeaconname_item.value,a.services[8].value=a.ibeaconname_item.value,location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={value:a.ibeaconname_item.value},a.saveiBeaconName=function(){return 0==trim(a.data.value).length||a.data.value<1||a.data.value>12?(showNativeAlert("Serial ID input (1-99999).The unit is 100ms,Please check you input.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]).controller("ConnectionModeCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.connectionmode_item.uuid)[0];c.write("hex",toHex(a.data.clientSide),function(){a.connectionmode_item.value=a.data.clientSide,a.services[a.connectionmode_item.index].text=a.connectionmode_item.value,a.services[a.connectionmode_item.index].value=a.connectionmode_item.value,location.href="#/event/config"},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.connectionModeList=[{text:"0    YES",value:"0"},{text:"1    NO",value:"1"}],a.data={clientSide:a.connectionmode_item.value},a.selectConnMode=function(){connectDevice(a.device,c)}}]).controller("SoftRebootCtrl",["$scope","$timeout",function(a){function c(b){var c=b.getCharacteristicByUUID(a.softreboot_item.uuid)[0];c.write("ascii",a.data.password,function(){var b,c;for(a.data.checked?(a.data.saveChange=!0,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(a.data)):localStorage.removeItem("softreboot_data_"+uuidToString(a.device.deviceAddress)),b=a.services[7].text.toString(),c=b.substring(b.length-5,b.length);c.length<5;)c="0"+c;localStorage["devicename_"+uuidToString(a.device.deviceAddress)]=a.services[8].text+c},function(){showNativeAlert("Write to devie failed,Please check you input.",function(){})})}a.data={password:"",checked:!1},a.device&&localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]&&(a.data=JSON.parse(localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]),a.data.saveChange&&(a.data.newPassword?(a.data.password=a.data.newPassword,delete a.data.saveChange,delete a.data.newPassword,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(a.data)):(delete a.data.saveChange,localStorage["softreboot_data_"+uuidToString(a.device.deviceAddress)]=JSON.stringify(a.data)))),a.savePassword=function(){return 0==trim(a.data.password)?(showNativeAlert("The password could not be null.",function(){}),void 0):(connectDevice(a.device,c),void 0)}}]);var serviceUUID="FFF0";